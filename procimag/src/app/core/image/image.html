<div class="flex h-1/2 gap-x-6 p-4 pt-0 overflow-hidden">
  <!-- PREVIEW ORIGINAL -->
  <div class="flex-1 bg-white shadow-lg min-h-0 flex flex-col" style="max-width: 100%; height: 400px;">
    <div class="flex-1 flex flex-col overflow-hidden">
      <img
        *ngIf="imageService.getImageDataUrl()"
        [src]="imageService.getImageDataUrl()"
        alt="Preview"
        class="w-full h-full object-contain min-h-0 min-w-0"
        style="height: 100%; width: 100%;"
      />
    </div>
    <div class="w-full">
      <label class="w-full block cursor-pointer py-3 px-4 text-center bg-zinc-200 hover:bg-zinc-300 transition">
        <input type="file" (change)="onFileSelected($event)" class="hidden" />
        <span>Adicionar arquivo</span>
      </label>
    </div>
  </div>

  <!-- PREVIEW PROCESSADA -->
  <div class="flex-1 bg-white shadow-lg min-h-0 flex flex-col" style="max-width: 100%; height: 400px;">
    <div class="flex-1 flex flex-col overflow-hidden">
      <img
        *ngIf="imageService.getEditedImageDataUrl()"
        [src]="imageService.getEditedImageDataUrl()"
        alt="Preview"
        class="w-full h-full object-contain min-h-0 min-w-0"
        style="height: 100%; width: 100%;"
      />
    </div>
    <div class="w-full">
      <a
        *ngIf="imageService.getEditedImageDataUrl()"
        [href]="imageService.getEditedImageDataUrl()"
        download="imagem-processada.png"
        class="w-full block py-3 px-4 text-center bg-zinc-200 hover:bg-zinc-300 transition rounded cursor-pointer"
      >
        Download
      </a>
      <label *ngIf="!imageService.getEditedImageDataUrl()" class="w-full block py-3 px-4 text-center bg-zinc-200 transition rounded cursor-not-allowed opacity-50">
        Download
      </label>
    </div>
  </div>
</div>

@if(imageService.getImageDataUrl()) {
  <!-- HISTOGRAMAS -->
  <div class="mt-13 flex flex-row shadow-lg ml-5" [class.hidden]="router.url !== '/dados'" style="max-width: max-content">
    <div class="flex flex-col items-start bg-white">
      <canvas #rCanvas width="266" height="120" class="bg-whitebg-white rounded"></canvas>
    </div>
    <div class="flex flex-col items-start bg-white">
      <canvas #gCanvas width="266" height="120" class="bg-whitebg-white rounded"></canvas>
    </div>
    <div class="flex flex-col items-start bg-white">
      <canvas #bCanvas width="266" height="120" class="bg-whitebg-white rounded"></canvas>
    </div>
  </div>
  
  <!-- METADADOS -->
  @if (router.url === '/dados') {
    <div class="px-4 mt-6">
      <div class="bg-white rounded shadow p-4" *ngIf="meta as m">
        <h2 class="text-lg font-semibold mb-3">Metadados</h2>
        
        <div class="grid grid-cols-2 gap-3 text-sm">
          <div><span class="text-zinc-500">MIME:</span> {{ m.container.mime || '—' }}</div>
          <div><span class="text-zinc-500">Extensão:</span> {{ m.container.extension || '—' }}</div>
          <div>
            <span class="text-zinc-500">Dimensões:</span>
            {{ m.container.width }} × {{ m.container.height }}
          </div>
          <div><span class="text-zinc-500">BitDepth:</span> {{ m.container.bitDepth || '—' }}</div>
          <div><span class="text-zinc-500">Samples/Pixel:</span> {{ m.container.samplesPerPixel || '—' }}</div>
          <div><span class="text-zinc-500">Color Space:</span> {{ m.container.colorSpace || '—' }}</div>
          <div><span class="text-zinc-500">Compressão:</span> {{ m.container.compression || '—' }}</div>
          <div><span class="text-zinc-500">Tem Alpha?</span> {{ m.computed?.hasAlpha ? 'Sim' : 'Não' }}</div>
        </div>
        
        <!-- Guard específico para as médias -->
        <div class="mt-4 text-sm" *ngIf="m.computed?.mean as mean">
          <h3 class="font-medium mb-2">Médias</h3>
          <div class="grid grid-cols-4 gap-3">
            <div><span class="text-zinc-500">R̄:</span> {{ mean.r | number:'1.0-1' }}</div>
            <div><span class="text-zinc-500">Ḡ:</span> {{ mean.g | number:'1.0-1' }}</div>
            <div><span class="text-zinc-500">B̄:</span> {{ mean.b | number:'1.0-1' }}</div>
            <div><span class="text-zinc-500">Ā:</span> {{ mean.a | number:'1.0-1' }}</div>
          </div>
        </div>
      </div>
    </div>
  }
}